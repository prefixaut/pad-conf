var O=Object.defineProperty;var H=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var g=(e,t,n)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||(t={}))F.call(t,n)&&g(e,n,t[n]);if(H)for(var n of H(t))U.call(t,n)&&g(e,n,t[n]);return e};var m=(e,t,n)=>(g(e,typeof t!="symbol"?t+"":t,n),n);import{u as C,a as G,c as T,R as s,F as y,S as V,B as f,b as z,C as B,d as j,e as W,f as Y,g as q,h as P,T as $,i as J,j as Q,k as X,l as Z,m as _,n as ee,N as te,G as ne,H as se,o as ae,p as ce,P as re}from"./vendor.24deaf2b.js";const le=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}};le();var i=(e=>(e.CONFIRMATION="confirmation",e.LIST_DEVICES="list-devices",e.SELECT_DEVICE="select-device",e.DEVICE_DISCONNECT="device-disconnect",e.SET_MEASUREMENT="set-measurement",e.GET_MEASUREMENT="get-measurement",e.MEASUREMENT_VALUE="measurement-value",e.GET_PANEL="get-panel",e.UPDATE_PANEL="update-panel",e.RESET_SETTINGS="reset-settings",e.SAVE_SETTINGS="save-settings",e.GET_LAYOUT="get-layout",e))(i||{});const v=()=>G(),p=C,oe=e=>t=>t.type===i.CONFIRMATION&&t.confirmationType===e.type,a=class{constructor(){}static addResponseHandler(t){a.responseHandlers.includes(t)||a.responseHandlers.push(t)}static removeResponseHandler(t){const n=a.responseHandlers.indexOf(t);n!==-1&&(a.responseHandlers=[...a.responseHandlers.slice(0,n),...a.responseHandlers.slice(n+1)])}static addCloseHandler(t){a.closeHandlers.includes(t)||a.closeHandlers.push(t)}static removeCloseHandler(t){const n=a.closeHandlers.indexOf(t);n!==-1&&(a.closeHandlers=[...a.closeHandlers.slice(0,n),...a.closeHandlers.slice(n+1)])}static isConnected(){return a.socket!=null}static isMeasurementEnabled(){return a.send({type:i.GET_MEASUREMENT}).then(t=>t.isEnabled)}static async handleIncomingMessage(t){const n=JSON.parse(t.data);for(const c of a.responseHandlers)try{typeof c.then=="function"?await c(n):c(n)}catch(r){console.error(r)}}static connect(t){return new Promise((n,c)=>{try{a.socket=new WebSocket(t),a.socketOpenHandler=()=>{n()},a.socketCloseHandler=()=>{a.disconnect(!1)},a.socket.addEventListener("open",a.socketOpenHandler),a.socket.addEventListener("message",a.handleIncomingMessage),a.socket.addEventListener("close",a.socketCloseHandler)}catch(r){c(r)}})}static disconnect(t=!0){if(a.socket!=null){if(a.socket!=null&&(a.socket.removeEventListener("open",a.socketOpenHandler),a.socket.removeEventListener("message",a.handleIncomingMessage),a.socket.removeEventListener("close",a.socketCloseHandler),a.socket.readyState===WebSocket.CONNECTING||a.socket.readyState===WebSocket.OPEN))try{a.socket.close(t?1e3:1006)}catch(n){console.error("Error while closing WebSocket connection",n)}a.socket=null,a.socketOpenHandler=null,a.socketCloseHandler=null;for(const n of a.closeHandlers)try{n(t)}catch(c){console.error(c)}}}static send(t,n=null){return a.socket==null?Promise.reject("No open connection!"):(n==null&&(n=oe(t)),a.socket.send(JSON.stringify(t)),new Promise((c,r)=>{let l=!1,u;const D=M=>{try{const E=JSON.parse(M.data);if(E.type!==i.CONFIRMATION||n==null||!n(E))return;E.confirmationSuccess?(l=!0,clearTimeout(u),c(E)):r("server rejected request!")}catch{}};a.socket!=null&&a.socket.addEventListener("message",D),u=window.setTimeout(()=>{a.socket!=null&&a.socket.removeEventListener("message",D),l||r("timeout reached, no response!")},5e3)}))}static listDevices(){return a.send({type:i.LIST_DEVICES}).then(t=>t.devices)}static selectDevice(t){return a.send({type:i.SELECT_DEVICE,devicePath:t})}static enableMeasurements(t){return a.send({type:i.SET_MEASUREMENT,measureEnable:t}).then(()=>{})}static getSinglePanel(t){return a.send({type:i.GET_PANEL,panelIndex:t},n=>n.confirmationType===i.GET_PANEL&&n.panelIndex===t).then(n=>n.settings)}static updateSinglePanel(t,n){return a.send({type:i.UPDATE_PANEL,panelIndex:t,settings:n},c=>c.confirmationType===i.UPDATE_PANEL&&c.panelIndex===t).then(()=>{})}static resetSettings(){return a.send({type:i.RESET_SETTINGS}).then(()=>{})}static saveSettings(){return a.send({type:i.SAVE_SETTINGS}).then(()=>{})}};let o=a;m(o,"socket"),m(o,"socketCloseHandler"),m(o,"socketOpenHandler"),m(o,"responseHandlers",[]),m(o,"closeHandlers",[]);const ie={loading:!1,measurements:!1,devices:[],selectedDevice:null,panels:[],selectedPanel:null,layout:null},I=T({name:"device",initialState:ie,reducers:{devices(e,t){e.devices=t.payload},setSelectedDevice(e,t){e.selectedDevice=t.payload},selectDevice(e,t){e.loading=!0,e.selectedDevice=t.payload},deviceSelected(e,t){e.loading=!1,e.panels=t.payload.panels,e.layout=t.payload.layout},mesasurements(e,t){t.payload!=null&&(e.measurements=t.payload)},panels(e,t){e.panels=t.payload},updatePanel(e,t){e.panels[t.payload.index]=t.payload.settings},selectPanel(e,t){e.selectedPanel=t.payload},layout(e,t){e.layout=t.payload}}}),{devices:h,selectDevice:de,setSelectedDevice:ue,deviceSelected:me,mesasurements:A,panels:pe,updatePanel:Ee,selectPanel:R}=I.actions;var he=I.reducer;function ye(e){let t=[e.manufacturer,e.pnpId].filter(n=>typeof n=="string"&&!n.startsWith("(")).join(" ").trim();return t!=""?t=`${t} (${e.path})`.trim():t=e.path,t}function fe(){const e=v(),{devices:t,measurements:n,selectedDevice:c}=p(l=>l.device),r=t.filter(l=>l.path);return s.createElement("section",null,s.createElement("div",{className:"form-row"},s.createElement(y,{htmlFor:"devices",label:"Devices",className:"flex-auto"},s.createElement(V,{options:r,children:l=>ye(l),onChange:l=>e(de(l.value)),placeholder:"Select Device",id:"devices",clear:!0})),s.createElement("div",{className:"my-auto ml-8"},s.createElement(f,{icon:s.createElement(z,null),primary:!0,label:"Reload",onClick:()=>o.listDevices()}))),c!=null&&s.createElement(s.Fragment,null,s.createElement("div",{className:"form-row mt-4 ml-2"},s.createElement(B,{checked:n,label:"Enable Value Measurements",toggle:!0,onChange:()=>o.enableMeasurements(!n)}))))}const Se=-1,ve=-1,N=0,b=1024;function ge(){const{layout:e,selectedPanel:t}=p(r=>r.device);let n=0;const c=(e||[]).map((r,l)=>{let u=s.createElement("div",{className:"panel",key:l});return r!==Se&&(u=ke(n,t,l),n++),u});return s.createElement("div",{className:"pad-display"},c)}function ke(e,t,n){const c=v(),r=["btn"];return t===e&&r.push("active"),s.createElement("div",{className:"panel input",key:n},s.createElement("button",{className:r.join(" "),onClick:()=>c(R(e))},s.createElement("code",null,Ne(n))))}function Ne(e){switch(e){case 0:return"\u2196";case 1:return"\u2191";case 2:return"\u2197";case 3:return"\u2190";case 4:return"\u25A0";case 5:return"\u2192";case 6:return"\u2199";case 7:return"\u2193";case 8:return"\u2198"}}const be={code:"ControlLeft",key:"Control",keyCode:17},Te={code:"ShiftLeft",key:"Shift",keyCode:16},De={code:"AltLeft",key:"Alt",keyCode:18},He={code:"AltRight",key:"AltGraph",keyCode:18};function Pe(e){return e.keyCode===18||e.keyCode===20||e.keyCode===17||e.keyCode===91||e.keyCode===92||e.keyCode===16}function Ie(e){switch(e){case 48:return{code:"Digit0",key:"0",keyCode:e};case 49:return{code:"Digit1",key:"1",keyCode:e};case 50:return{code:"Digit2",key:"2",keyCode:e};case 51:return{code:"Digit3",key:"3",keyCode:e};case 52:return{code:"Digit4",key:"4",keyCode:e};case 53:return{code:"Digit5",key:"5",keyCode:e};case 54:return{code:"Digit6",key:"6",keyCode:e};case 55:return{code:"Digit7",key:"7",keyCode:e};case 56:return{code:"Digit8",key:"8",keyCode:e};case 57:return{code:"Digit9",key:"0",keyCode:e};case 65:return{code:"KeyA",key:"a",keyCode:e};case 66:return{code:"KeyB",key:"b",keyCode:e};case 67:return{code:"KeyC",key:"c",keyCode:e};case 68:return{code:"KeyD",key:"d",keyCode:e};case 69:return{code:"KeyE",key:"e",keyCode:e};case 70:return{code:"KeyF",key:"f",keyCode:e};case 71:return{code:"KeyG",key:"g",keyCode:e};case 72:return{code:"KeyH",key:"h",keyCode:e};case 73:return{code:"KeyI",key:"i",keyCode:e};case 74:return{code:"KeyJ",key:"j",keyCode:e};case 75:return{code:"KeyK",key:"k",keyCode:e};case 76:return{code:"KeyL",key:"l",keyCode:e};case 77:return{code:"KeyM",key:"m",keyCode:e};case 78:return{code:"KeyN",key:"n",keyCode:e};case 79:return{code:"KeyO",key:"o",keyCode:e};case 80:return{code:"KeyP",key:"p",keyCode:e};case 81:return{code:"KeyQ",key:"q",keyCode:e};case 82:return{code:"KeyR",key:"r",keyCode:e};case 83:return{code:"KeyS",key:"s",keyCode:e};case 84:return{code:"KeyT",key:"t",keyCode:e};case 85:return{code:"KeyU",key:"u",keyCode:e};case 86:return{code:"KeyV",key:"v",keyCode:e};case 87:return{code:"KeyW",key:"w",keyCode:e};case 88:return{code:"KeyX",key:"x",keyCode:e};case 89:return{code:"KeyY",key:"z",keyCode:e};case 90:return{code:"KeyZ",key:"z",keyCode:e};case 188:return{code:"Comma",key:",",keyCode:e};case 190:return{code:"Period",key:".",keyCode:e};case 186:return{code:"Semicolon",key:";",keyCode:e};case 222:return{code:"Quote",key:'"',keyCode:e};case 219:return{code:"BracketLeft",key:"(",keyCode:e};case 221:return{code:"BracketRight",key:")",keyCode:e};case 192:return{code:"Backquote",key:"`",keyCode:e};case 220:return{code:"Backslash",key:"\\",keyCode:e};case 189:return{code:"Minus",key:"-",keyCode:e};case 187:return{code:"Equal",key:"=",keyCode:e};case 93:return{code:"ContextMenu",key:"ContextMenu",keyCode:e};case 13:return{code:"Enter",key:"Enter",keyCode:e};case 32:return{code:"Space",key:"Space",keyCode:e};case 9:return{code:"Tab",key:"Tab",keyCode:e};case 46:return{code:"Delete",key:"Delete",keyCode:e};case 35:return{code:"End",key:"End",keyCode:e};case 36:return{code:"Home",key:"Home",keyCode:e};case 45:return{code:"Insert",key:"Insert",keyCode:e};case 34:return{code:"PageDown",key:"PageDown",keyCode:e};default:return null}}const Ae={url:null,connected:!1,loading:!1},K=T({name:"backend",initialState:Ae,reducers:{connect(e,t){e.url=t.payload,e.connected=!1,e.loading=!0},connected(e){e.connected=!0,e.loading=!1},disconnect(e){e.url=null,e.connected=!1,e.loading=!1}}}),{connect:Re,connected:Ke,disconnect:x}=K.actions;var xe=K.reducer;const Le={openToasts:[]},L=T({name:"toast",initialState:Le,reducers:{open(e,t){e.openToasts.includes(t.payload)||e.openToasts.push(t.payload)},close(e,t){const n=e.openToasts.indexOf(t.payload);n!==-1&&(e.openToasts=[...e.openToasts.slice(0,n),...e.openToasts.slice(n)])},closeAll(e){e.openToasts=[]}}}),{open:S,close:w,closeAll:qe}=L.actions;var we=L.reducer;const Me=e=>t=>n=>{var c;switch(n.type){case"backend/connect":o.connect(n.payload).then(()=>o.listDevices()).then(r=>{e.dispatch(Ke()),e.dispatch(h(r))}).catch(r=>{console.log(r),e.dispatch(S({title:"Server not reached",message:"Connection to server could not be established!",status:"critical"})),e.dispatch(x())});break;case"device/selectDevice":o.selectDevice((c=n.payload)==null?void 0:c.path).then(r=>{o.isMeasurementEnabled().then(l=>{e.dispatch(A(l)),e.dispatch(me({layout:r.layout,panels:r.panels}))})});break}return t(n)},Oe=e=>t=>n=>{switch(n.type){case"toast/open":n.payload.expire>0&&setTimeout(()=>{e.dispatch(w(n.payload))},n.payload.expire);break}return t(n)},Fe=j({backend:xe,toast:we,device:he}),d=W(Fe,Y(Me,Oe));class Ue extends s.Component{constructor(t){super(t);this.state={altRightPressed:!1}}handleKey(t){if(t.key==="Tab")return;t.preventDefault(),t.stopPropagation();const n=[];if(!(t.key==="Control"||t.key==="Alt"||t.key==="Shift")){if(this.props.allowAccelerators&&(t.ctrlKey&&n.push(be),t.shiftKey&&n.push(Te),t.altKey&&n.push(De),this.state.altRightPressed&&n.push(He),t.code==="AltRight")){this.setState({altRightPressed:!0});return}switch(t.key){case"Shift":case"Alt":case"Super":case"Ctrl":case"AltGraph":break;default:n.push({code:t.code,key:t.key,keyCode:t.keyCode})}typeof this.props.onChange=="function"&&this.props.onChange(n)}}handleKeyUp(t){t.code==="AltGraph"&&this.setState({altRightPressed:!1})}render(){const{value:t}=this.props,n=(Array.isArray(t)?t:[t]).map(c=>c==null?void 0:c.key).filter(c=>c!=null).join(" + ");return s.createElement("div",{className:"keybind-input"},s.createElement("div",{ref:"content",contentEditable:!0,className:"content",tabIndex:0,onKeyDown:c=>this.handleKey(c),onKeyUp:c=>this.handleKeyUp(c)}),s.createElement("div",{className:"value"},s.createElement("code",null,n)))}}class Ce extends s.Component{constructor(t){super(t);m(this,"messageHandlerRef");m(this,"closeHandlerRef");this.state={deadzoneStart:N,deadzoneEnd:b,keyCode:ve,currentValue:null}}componentDidMount(){this.messageHandlerRef=t=>this.messageHandler(t),this.closeHandlerRef=()=>this.closeHandler(),o.addResponseHandler(this.messageHandlerRef),o.addCloseHandler(this.closeHandlerRef),this.setState(k({},this.props.settings))}componentDidUpdate(t,n,c){t.panelIndex!==this.props.panelIndex&&this.setState(k({},this.props.settings))}componentWillUnmount(){o.removeCloseHandler(this.closeHandlerRef),o.removeResponseHandler(this.messageHandlerRef)}closeHandler(){o.removeCloseHandler(this.closeHandlerRef),o.removeResponseHandler(this.messageHandlerRef)}messageHandler(t){switch(t.type){case i.MEASUREMENT_VALUE:t.measurePanelIndex===this.props.panelIndex&&this.setState({currentValue:t.measureValue});break}}updatePanel(){const t=this.state;o.updateSinglePanel(this.props.panelIndex,t).then(()=>d.dispatch(Ee({index:this.props.panelIndex,settings:t}))).catch(n=>{console.error("Error while updating Panel",this.props,this.state,n),d.dispatch(S({title:"Could not update Panel!",message:"Due to an error, the Panel could not be updated!",status:"warning"}))})}savePad(){o.saveSettings()}updateDeadzone(t){this.setState({deadzoneStart:t[0],deadzoneEnd:t[1]})}setKey(t){var n;this.setState({keyCode:(n=(Array.isArray(t)?t:[t]).filter(c=>!Pe(c))[0])==null?void 0:n.keyCode})}render(){const{deadzoneStart:t,deadzoneEnd:n,keyCode:c,currentValue:r}=this.state;return s.createElement(s.Fragment,null,s.createElement(y,{label:"Deadzone",htmlFor:"input-deadzone"},s.createElement(q,null,s.createElement(P,{direction:"row",justify:"between"},[N,b].map(l=>s.createElement(P,{key:l,pad:"small",border:!1},s.createElement($,{style:{fontFamily:"monospace"}},l)))),s.createElement(J,{size:"full",direction:"horizontal",min:N,max:b,values:[t,n],onChange:l=>this.updateDeadzone(l),id:"input-deadzone"}),s.createElement("div",{className:"mt-4 select-none"},s.createElement("code",{className:"text-center text-outline w-100 block"},t," - ",n)))),this.props.measurementEnabled&&s.createElement(s.Fragment,null,s.createElement("div",{className:"ml-4"},s.createElement("span",null,"Current Measurment:\xA0"),s.createElement("code",null,r))),s.createElement(y,{label:"Keybind",className:"mb-4 mt-4"},s.createElement(Ue,{onChange:l=>this.setKey(l),value:Ie(c)})),s.createElement("div",{className:"btn-group mt-6"},s.createElement(f,{primary:!0,className:"btn",label:"Apply",onClick:()=>this.updatePanel()}),s.createElement(f,{primary:!0,className:"btn btn-success",label:"Save",onClick:()=>this.savePad()})))}}function Ge(){const{loading:e,selectedPanel:t,panels:n,measurements:c}=p(r=>r.device);return s.createElement("section",{className:"editor container"},s.createElement("main",{className:"editor-content"},t!=null&&s.createElement(Ce,{panelIndex:t,settings:n[t],measurementEnabled:c}),t==null&&s.createElement(s.Fragment,null,"Please select a Panel first!")),s.createElement("aside",{className:"input-display"},!e&&s.createElement(ge,null)))}function Ve(){const{connected:e,loading:t}=p(l=>l.backend),n=v();function c(l){const u=l.value.url;n(Re(u))}function r(){o.disconnect(!0)}return s.createElement(s.Fragment,null,s.createElement(Q,{onSubmit:l=>e?r():c(l)},s.createElement("div",{className:"form-row"},s.createElement(y,{name:"url",htmlFor:"url",label:"Server URL",className:"flex-auto"},s.createElement(X,{disabled:e||t,value:"ws://localhost:8000/",id:"url",name:"url"})),s.createElement("div",{className:"my-auto ml-8"},s.createElement(f,{className:e?"btn btn-error":"btn",primary:!e,label:e?"Disconnect":"Connect",type:"submit",disabled:t,icon:e?s.createElement(Z,null):s.createElement(_,null)})))),t&&s.createElement(s.Fragment,null,s.createElement(ee,null),s.createElement("div",null,"Connecting to server ...")))}function ze(){const e=p(n=>n.toast.openToasts),t=v();return s.createElement(s.Fragment,null,e.map((n,c)=>s.createElement(te,{key:c,toast:!0,title:n.title||"",message:n.message,status:n.status,onClose:()=>t(w(n))})))}function Be(){const e=p(n=>n.backend.connected),{selectedDevice:t}=p(n=>n.device);return s.createElement(ne,{themeMode:"dark",className:"app",cssVars:!0},s.createElement(se,{className:"app-header"},s.createElement(ae,null,"Calibrator")),s.createElement("main",{className:"app-body"},s.createElement("div",{className:"container"},s.createElement(Ve,null),e&&je(t))),s.createElement(ze,null))}function je(e){return s.createElement(s.Fragment,null,s.createElement(fe,null),e!=null&&s.createElement(s.Fragment,null,s.createElement("hr",{className:"my-8"}),s.createElement(Ge,null)))}ce.render(s.createElement(s.StrictMode,null,s.createElement(re,{store:d},s.createElement(Be,null))),document.getElementById("root"));(()=>{function e(){d.dispatch(h([])),d.dispatch(ue(null)),d.dispatch(pe([])),d.dispatch(R(null))}o.addCloseHandler(t=>{d.dispatch(x()),e(),t||d.dispatch(S({title:"Server disconnected!",message:"The connection to the server has been unexpectedly disconnected!",status:"critical",expire:5e3}))}),o.addResponseHandler(t=>{switch(t.type){case i.CONFIRMATION:switch(t.confirmationType){case i.LIST_DEVICES:d.dispatch(h(t.devices));break;case i.SET_MEASUREMENT:d.dispatch(A(t.isEnabled));break}break;case i.DEVICE_DISCONNECT:o.listDevices().then(n=>d.dispatch(h(n))),e(),d.dispatch(S({title:"Device disconnected!",message:"The device has unexpectedly disconnected!",status:"critical",expire:5e3}));break}})})();
